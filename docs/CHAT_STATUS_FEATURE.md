# 聊天状态功能

## 功能概述

聊天状态功能为单聊界面添加了AI角色的实时状态显示，包括心情、位置和穿着信息。这些状态信息会显示在聊天界面的顶部，让用户能够更好地了解AI角色的当前状态。

## 功能特性

### 1. 状态显示
- **在线状态**: 显示AI角色是否在线
- **心情**: 显示AI角色的当前心情（如：心情愉快、有点疲惫等）
- **位置**: 显示AI角色当前所在位置（如：在家中、在咖啡厅等）
- **穿着**: 显示AI角色今天的穿着（如：穿着蓝色连衣裙、穿着休闲装等）

### 2. 状态更新
- AI可以通过对话自然地更新自己的状态
- 状态信息会持久化保存到数据库中
- 支持实时状态同步

## 技术实现

### 组件结构

```
src/app/components/qq/chatstatus/
├── index.ts                    # 模块导出
├── ChatStatusManager.tsx       # 状态管理器
├── ChatStatusDisplay.tsx       # 状态显示组件
├── ChatStatusDisplay.css       # 状态显示样式
└── ChatStatusPrompt.tsx        # 状态提示词组件
```

### 核心组件

#### 1. ChatStatusManager
- 负责状态数据的加载和保存
- 与数据库交互，持久化状态信息
- 提供状态更新回调

#### 2. ChatStatusDisplay
- 渲染状态信息的UI组件
- 支持响应式设计
- 显示状态图标和文字

#### 3. ChatStatusPrompt
- 生成状态相关的系统提示词
- 解析AI返回的状态更新指令
- 提供状态注入功能

### 数据库集成

在 `dataManager.ts` 中添加了聊天状态相关的数据库操作：

- `saveChatStatus()`: 保存聊天状态
- `getChatStatus()`: 获取聊天状态
- `deleteChatStatus()`: 删除聊天状态

### AI指令支持

AI可以通过以下JSON格式更新状态：

```json
{
  "type": "status_update",
  "mood": "心情愉快",
  "location": "在咖啡厅",
  "outfit": "穿着蓝色连衣裙"
}
```

## 使用方法

### 1. 自动显示
在单聊界面中，状态信息会自动显示在聊天头部，替换原来的简单"在线"状态。

### 2. AI状态更新
AI会在对话中自然地提及和更新自己的状态，例如：
- "我今天心情很好，穿着新买的蓝色连衣裙"
- "我在咖啡厅里，穿着休闲装，感觉很放松"

### 3. 状态持久化
状态信息会自动保存到本地数据库，下次打开聊天时会恢复之前的状态。

## 界面效果

```
┌─────────────────────────────────────────────────────────┐
│ ‹  [头像] AI角色名称                    [心情] [位置] [穿着] │
│    在线 · 心情愉快 · 在咖啡厅 · 穿着蓝色连衣裙              │
└─────────────────────────────────────────────────────────┘
```

## 配置选项

### 默认状态
如果AI没有主动更新状态，系统会使用默认状态：
- 心情：心情愉快
- 位置：在家中
- 穿着：穿着休闲装

### 响应式设计
状态显示组件支持移动端适配，在小屏幕上会自动调整布局和字体大小。

## 扩展性

该功能设计具有良好的扩展性：

1. **状态类型扩展**: 可以轻松添加新的状态类型（如：活动、天气等）
2. **状态源扩展**: 可以集成外部API获取实时状态信息
3. **UI定制**: 状态显示组件支持主题定制和样式调整
4. **群聊支持**: 可以扩展到群聊中，显示每个成员的状态

## 注意事项

1. 状态功能仅在单聊中启用，群聊仍显示成员数量
2. 状态更新不会产生聊天消息，只更新状态信息
3. 状态信息会定期保存，确保数据不丢失
4. 支持离线状态显示，即使没有网络连接也能显示保存的状态 