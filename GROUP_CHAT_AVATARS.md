# 群聊用户头像和名字显示功能

## 功能概述

在群聊中，每条消息都会显示发送者的头像和名字，让用户能够清楚地区分不同成员发送的消息。

## 核心功能

### 1. 用户头像显示
- **用户消息**：显示用户在群里的头像
- **AI消息**：显示对应AI角色的头像
- **头像来源**：优先使用消息中的senderAvatar，其次使用群成员信息

### 2. 用户名字显示
- **用户消息**：显示用户在群里的昵称
- **AI消息**：显示AI角色在群里的昵称
- **名字来源**：从群成员信息中获取groupNickname

### 3. 连续消息优化
- **智能隐藏**：同一发送者的连续消息只显示一次头像和名字
- **视觉优化**：连续消息使用特殊的圆角样式
- **空间节省**：减少重复信息，让聊天更紧凑

## 技术实现

### 发送者信息获取逻辑

```typescript
const getSenderInfo = () => {
  if (msg.role === 'user') {
    return {
      name: chat.settings.myNickname || '我',
      avatar: chat.settings.myAvatar || '/avatars/user-avatar.svg'
    };
  } else {
    // AI消息，从群成员中查找对应的成员信息
    if (chat.isGroup && chat.members && msg.senderName) {
      const member = chat.members.find(m => m.originalName === msg.senderName);
      if (member) {
        return {
          name: member.groupNickname,
          avatar: member.avatar
        };
      }
    }
    return {
      name: msg.senderName || chat.name,
      avatar: msg.senderAvatar || chat.avatar
    };
  }
};
```

### 连续消息检测

```typescript
const isConsecutiveMessage = index > 0 && 
  chat.messages[index - 1].senderName === msg.senderName &&
  chat.messages[index - 1].role === msg.role;
```

### 消息渲染优化

- **头像显示**：每条消息都显示发送者头像
- **名字显示**：群聊中显示发送者名字（连续消息除外）
- **样式优化**：连续消息使用特殊样式

## 显示效果

### 单条消息
```
[头像] 用户名
      消息内容
      时间
```

### 连续消息
```
[头像] 用户名
      消息内容1
      时间1
      消息内容2  ← 连续消息，隐藏头像和名字
      时间2
```

### 不同用户消息
```
[头像A] 用户A
       消息内容
       时间

[头像B] 用户B
       消息内容
       时间
```

## 样式特点

### 头像样式
- **尺寸**：30x30像素
- **形状**：圆形
- **位置**：消息左侧
- **间距**：与消息内容保持适当距离

### 名字样式
- **字体**：12px，加粗
- **颜色**：用户消息为绿色，AI消息为蓝色
- **背景**：半透明背景，圆角设计
- **显示**：仅在群聊中显示，连续消息隐藏

### 连续消息样式
- **头像**：隐藏（visibility: hidden）
- **名字**：隐藏（display: none）
- **圆角**：特殊圆角设计，视觉上连接
- **间距**：减少间距，更紧凑

## 响应式设计

### 桌面端
- 完整显示头像和名字
- 消息气泡最大宽度80%
- 清晰的视觉层次

### 移动端
- 头像尺寸适当缩小
- 名字字体稍小
- 优化触摸体验

### 小屏设备
- 更紧凑的布局
- 减少不必要的空白
- 保持可读性

## 用户体验优化

### 1. 视觉清晰度
- 每个用户都有独特的头像
- 名字使用不同颜色区分
- 消息气泡样式区分用户和AI

### 2. 信息密度
- 连续消息隐藏重复信息
- 保持聊天界面的整洁
- 重要信息突出显示

### 3. 交互友好
- 头像可点击（预留功能）
- 名字可点击（预留功能）
- 支持消息引用功能

## 兼容性

- ✅ 现代浏览器支持
- ✅ 移动端优化
- ✅ 深色模式适配
- ✅ 无障碍支持
- ✅ 高分辨率屏幕适配

## 后续优化

1. **头像点击功能**：点击头像查看用户信息
2. **名字点击功能**：点击名字@用户
3. **在线状态**：显示用户在线状态
4. **角色标识**：显示群主、管理员等角色
5. **自定义头像**：支持用户上传自定义头像 