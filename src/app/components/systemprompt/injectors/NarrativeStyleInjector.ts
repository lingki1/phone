import { PromptInjector } from '../types';

export class NarrativeStyleInjector implements PromptInjector {
  priority = 15; // 叙述风格注入优先级中等

  async inject(): Promise<string> {
    console.log('NarrativeStyleInjector: 开始注入叙述风格指导');
    
    const narrativeContent = this.buildNarrativeStyleContent();
    
    console.log('NarrativeStyleInjector: 成功注入叙述风格内容');
    
    return narrativeContent;
  }

  // 构建叙述风格内容
  private buildNarrativeStyleContent(): string {
    return `

# 叙述风格指导

## 语言风格要求
- **文学性表达**: 采用优美、流畅的文学语言
- **细节描写**: 注重环境、动作、心理的细节刻画
- **修辞运用**: 适当运用比喻、象征、拟人等修辞手法
- **节奏控制**: 控制语言节奏，张弛有度
- **情感表达**: 通过语言传达丰富的情感层次

## 叙述模式说明
### 1. 对话模式
- **格式**: 使用引号标记对话内容
- **特点**: 展现角色性格和关系
- **要求**: 对话要自然、真实，符合角色身份
- **示例**: "你好，"她轻声说道，"今天天气真不错。"

### 2. 叙述模式
- **格式**: 第三人称叙述，客观描述
- **特点**: 推进情节，描述环境
- **要求**: 注重场景描写和氛围营造
- **示例**: 阳光透过窗帘洒在桌面上，形成斑驳的光影。

### 3. 状态模式
- **格式**: 深入角色内心，心理描写
- **特点**: 展现角色内心世界
- **要求**: 细腻描写情感变化和心理活动
- **示例**: 她的心中涌起一阵复杂的情绪，既有期待，又有一丝不安。

### 4. 动作模式
- **格式**: 生动描述角色动作
- **特点**: 增强画面感和动态感
- **要求**: 动作描写要具体、生动
- **示例**: 她缓缓站起身，走到窗边，凝视着远方的山峦。

## 描写技巧指导
- **环境描写**: 注重氛围营造，用环境烘托情节
- **人物描写**: 通过外貌、动作、语言展现性格
- **心理描写**: 深入角色内心，展现情感变化
- **细节描写**: 抓住关键细节，增强真实感
- **对比描写**: 运用对比手法，突出主题

## 叙述视角控制
- **全知视角**: 了解所有角色的内心和行动
- **限知视角**: 只了解特定角色的内心
- **客观视角**: 只描述外在行动，不涉及内心
- **视角切换**: 根据需要灵活切换叙述视角

## 情感表达技巧
- **直接表达**: 直接描述角色的情感状态
- **间接表达**: 通过动作、语言间接表达情感
- **环境烘托**: 用环境描写烘托情感氛围
- **细节暗示**: 通过细节暗示情感变化
- **对比突出**: 用对比手法突出情感变化`;
  }
}
