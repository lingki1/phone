# 群聊记忆管理功能

## 功能概述

群聊记忆管理功能允许群聊中的每个AI角色继承与用户的单聊记忆，让AI在群聊中保持更真实的关系和互动。

## 主要特性

### 1. 记忆链接
- 为群聊中的每个AI角色链接对应的单聊
- 自动检测可用的单聊联系人
- 显示记忆数量和最后更新时间

### 2. 记忆预览
- 预览每个角色的单聊记忆内容
- 显示最近20条对话记录
- 区分用户和AI的消息

### 3. 记忆刷新
- 实时刷新单聊记忆数据
- 确保群聊中的记忆是最新的
- 自动同步单聊中的新消息

### 4. 记忆管理
- 链接/取消链接单聊记忆
- 批量管理多个角色的记忆
- 直观的状态显示

## 使用方法

### 1. 访问记忆管理
在群聊界面中，点击顶部导航栏的 🧠 按钮打开记忆管理器。

### 2. 链接单聊记忆
1. 在记忆管理器中，找到要链接记忆的角色
2. 从下拉菜单中选择对应的单聊
3. 系统会自动链接并缓存单聊记忆

### 3. 预览记忆
1. 点击已链接角色的 "👁️ 预览" 按钮
2. 查看该角色与用户的单聊历史
3. 显示最近20条对话记录

### 4. 刷新记忆
1. 点击 "🔄 刷新" 按钮
2. 系统会从数据库重新获取最新的单聊数据
3. 更新群聊中的记忆缓存

### 5. 取消链接
1. 点击 "🔗 取消链接" 按钮
2. 移除该角色的单聊记忆链接
3. 角色将不再使用单聊记忆

## 技术实现

### 数据结构
```typescript
interface GroupMember {
  id: string;
  originalName: string;
  groupNickname: string;
  avatar: string;
  persona: string;
  singleChatId?: string;        // 对应的单聊ID
  singleChatMemory?: Message[]; // 单聊记忆缓存
}
```

### AI提示词增强
群聊AI会收到包含单聊记忆的系统提示词：
```
# 单聊记忆信息
## 角色A 与 用户 的单聊记忆 (50 条记录)
最近5条对话：
用户: 你好
角色A: 你好！最近怎么样？
用户: 还不错
角色A: 那就好，有什么需要帮助的吗？
用户: 谢谢关心
```

### 记忆同步
- 创建群聊时自动检测可用的单聊
- 实时更新记忆状态
- 支持手动刷新和自动同步

## 注意事项

1. **性能考虑**: 记忆缓存会占用一定内存，建议定期刷新
2. **数据一致性**: 单聊更新后需要手动刷新群聊记忆
3. **隐私保护**: 记忆数据仅存储在本地，不会上传到服务器
4. **兼容性**: 支持现有的所有聊天功能，不影响其他特性

## 未来计划

- [ ] 自动记忆同步
- [ ] 记忆重要性评分
- [ ] 记忆搜索功能
- [ ] 记忆导出/导入
- [ ] 记忆分析统计 