# 单聊群聊记忆管理功能

## 功能概述

单聊群聊记忆管理功能允许单聊中的AI角色继承在群聊中的互动记忆，让AI在单聊中了解用户在群聊中的表现和关系，实现更真实的对话体验。

## 主要特性

### 1. 群聊记忆链接
- 为单聊中的AI角色链接对应的群聊记忆
- 自动检测可用的群聊
- 显示该角色在群聊中的消息数量和最后更新时间

### 2. 群聊记忆预览
- 预览AI角色在群聊中的表现
- 显示最近20条群聊对话记录
- 区分用户和AI的消息

### 3. 群聊记忆刷新
- 实时刷新群聊记忆数据
- 确保单聊中的记忆是最新的
- 自动同步群聊中的新消息

### 4. 群聊记忆管理
- 链接/取消链接群聊记忆
- 批量管理多个群聊的记忆
- 直观的状态显示

## 使用方法

### 1. 访问群聊记忆管理
在单聊界面中，点击顶部导航栏的 🧠 按钮打开群聊记忆管理器。

### 2. 链接群聊记忆
1. 在群聊记忆管理器中，找到要链接记忆的群聊
2. 点击 "🔗 链接记忆" 按钮
3. 系统会自动链接该群聊中当前AI角色的消息

### 3. 预览群聊记忆
1. 点击已链接群聊的 "👁️ 预览" 按钮
2. 查看该AI角色在群聊中的表现
3. 显示最近20条群聊对话记录

### 4. 刷新群聊记忆
1. 点击 "🔄 刷新" 按钮
2. 系统会从数据库重新获取最新的群聊数据
3. 更新单聊中的群聊记忆

### 5. 取消链接
1. 点击 "🔗 取消链接" 按钮
2. 移除该群聊的记忆链接
3. AI将不再使用该群聊的记忆

## 技术实现

### 数据结构
```typescript
interface ChatSettings {
  // ... 其他字段
  linkedGroupChatIds?: string[]; // 单聊关联的群聊ID列表
}
```

### AI提示词增强
单聊AI会收到包含群聊记忆的系统提示词：
```
# 群聊记忆信息
## 群聊名称 中的群聊记忆 (50 条记录)
最近5条对话：
用户: 你好
AI角色: 你好！最近怎么样？
用户: 还不错
AI角色: 那就好，有什么需要帮助的吗？
用户: 谢谢关心
```

### 记忆同步
- 自动检测可用的群聊
- 实时更新记忆状态
- 支持手动刷新和自动同步

## 与群聊记忆管理的区别

| 功能 | 群聊记忆管理 | 单聊记忆管理 |
|------|-------------|-------------|
| 目标 | 群聊中的AI角色继承单聊记忆 | 单聊中的AI角色继承群聊记忆 |
| 数据来源 | 单聊消息历史 | 群聊中该角色的消息 |
| 记忆内容 | 用户与AI的单聊对话 | AI在群聊中的表现 |
| 应用场景 | 群聊中体现个人关系 | 单聊中体现群聊关系 |

## 注意事项

1. **性能考虑**: 群聊记忆缓存会占用一定内存，建议定期刷新
2. **数据一致性**: 群聊更新后需要手动刷新单聊记忆
3. **隐私保护**: 记忆数据仅存储在本地，不会上传到服务器
4. **兼容性**: 支持现有的所有聊天功能，不影响其他特性
5. **角色匹配**: 只有群聊中存在相同名称的AI角色才能链接记忆

## 未来计划

- [ ] 自动记忆同步
- [ ] 记忆重要性评分
- [ ] 记忆搜索功能
- [ ] 记忆导出/导入
- [ ] 记忆分析统计
- [ ] 跨角色记忆关联 